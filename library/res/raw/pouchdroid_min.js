var PouchDroid;!function(){"use strict";PouchDroid={DEBUG_MODE:!1,DEBUG_CLASSES:["NativeXMLHttpRequest","PouchDBHelper"],fakeLocalStorage:{},pouchDBs:{}}}(),function(){"use strict";function a(a){PouchDroid.Util.debug("SQLiteNativeDB",a)}function b(b){b=b||function(){};var c=e++,d=function(){a("executing callback with id: "+c),b.apply(null,arguments)};return f.callbacks[c]=d,c}var c=0,d=0,e=0,f={callbacks:{},nativeDBs:{}};f.clearCallbacks=function(a){a.forEach(function(a){delete f.callbacks[a]})},f.onNativeCallback=function(b,c){a("onNativeCallback("+b+", "+c+")");var d=f.callbacks[b];d?d.apply(null,c?[c]:null):window.console.log("callback not found for id "+b+"! "+d)};var g=function(a,b){var c=this;c.sql=a,c.selectArgs=b,c.queryId=d++},h=function(b,d,e,f){var g=this;g.callback=b,g.success=e,g.error=d,g.nativeDB=f,g.queriesIn=[],g.queriesStarted=[],g.queriesDone=[],g.sentEndAsFailure=!1,g.transactionId=c++,a("created new transaction with id "+g.transactionId)};h.prototype.debugQueryStatus=function(){var b=this;PouchDroid.DEBUG_MODE&&a("transactionId "+b.transactionId+": (queriesIn: "+b.queriesIn.length+", queriesStarted: "+b.queriesStarted.length+", queriesDone: "+b.queriesDone.length+")")},h.prototype.wrapQuerySuccess=function(b,c){var d=this;return function(e,f){a("wrapQuerySuccess(), transactionId "+d.transactionId),b&&"function"==typeof b&&b(e,f),d.queriesDone.push(c),d.runNextQueryOrEnd()}},h.prototype.wrapQueryError=function(b,c){var d=this;return function(e){if(a("wrapQueryError(), transactionId "+d.transactionId),b&&"function"==typeof b){a("running queryError"),d.debugQueryStatus();var f=b(d,e);a("ran queryError"),d.debugQueryStatus(),f?(a("failed to correct error, entire transaction is in error"),d.markTransactionInError=!0):a("successfully corrected error, may proceed")}else a("no fallback to correct error, entire transaction is in error"),d.markTransactionInError=!0;d.queriesDone.push(c),d.runNextQueryOrEnd()}},h.prototype.runNextQueryOrEnd=function(){var b=this;if(a("runNextQueryOrEnd(), transactionId "+b.transactionId),b.markTransactionInError)a("ending this transaction unsuccessfully for id "+b.transactionId),b.sentEndAsFailure||(b.endAsFailure(),b.sentEndAsFailure=!0);else if(b.queriesIn.length){a("transactionId "+b.transactionId+": there are "+b.queriesIn.length+"; popping one off the top...");var c=b.queriesIn.shift();b.queriesStarted.push(c),b.debugQueryStatus(),b.nativeDB.executeSql(c,b)}else{a("transactionId "+b.transactionId+": no more queries; end the transaction, maybe?"),b.debugQueryStatus();var d=0===b.queriesIn.length&&b.queriesStarted.length>0&&b.queriesStarted.length===b.queriesDone.length;d&&(a("ending this transaction successfully with id "+b.transactionId),b.endAsSuccessful())}},h.prototype.endAsFailure=function(){var c=this,d=b(function(){a("transactionId "+c.transactionId+": cleaning up after failure."),c.error(),c.nativeDB.processNextTransaction()});SQLiteJavascriptInterface.endTransaction(c.transactionId,c.nativeDB.name,d,d,!1)},h.prototype.endAsSuccessful=function(){var c=this,d=b(function(){a("executing transaction success for transactionId "+c.transactionId),c.success&&"function"==typeof c.success&&c.success(),c.nativeDB.processNextTransaction()}),e=b(function(){a("executing transaction error for transactionId "+c.transactionId),c.error&&"function"==typeof c.error&&c.error(),c.nativeDB.processNextTransaction()});SQLiteJavascriptInterface.endTransaction(c.transactionId,c.nativeDB.name,d,e,!0)},h.prototype.executeSql=function(b,c,d,e){var f=this,h=new g(b,c);h.querySuccess=f.wrapQuerySuccess(d,h),h.queryError=f.wrapQueryError(e,h),f.queriesIn.push(h),a("transaction "+f.transactionId+" got a new query"),f.debugQueryStatus(),f.runNextQueryOrEnd()};var i=function(a){var b=this;b.name=a,b.transactions=[]};i.prototype.init=function(c){var d=this;a("init()");var e=b(function(){c&&"function"==typeof c&&c()});SQLiteJavascriptInterface.open(d.name,e)},i.prototype.transaction=function(b,c,d){var e=this;a("transaction()"),e.transactions.push(new h(b,c,d,e)),e.processNextTransaction()},i.prototype.processNextTransaction=function(){var c=this;if(a("processTransaction()"),c.transactions.length){var d=c.transactions.shift();a("processing transaction with id "+d.transactionId),a("remaining transactions are: "+JSON.stringify(c.transactions.map(function(a){return a.transactionId})));var e=b(d.error),f=b(function(){d.callback(d)});SQLiteJavascriptInterface.startTransaction(d.transactionId,c.name,f,e)}},i.prototype.executeSql=function(c,d){var e=this;a("executeSql()");var f=b(function(b){a("query success!");var e=b&&b.rows?b.rows:[],f={rows:{item:function(a){return e[a]},length:e.length},rowsAffected:b&&b.rowsAffected?b.rowsAffected:0,insertId:b&&b.insertId?b.insertId:0};a("calling querySuccess function..."),d.debugQueryStatus(),c.querySuccess(d,f),a("querySuccess called."),d.debugQueryStatus()}),g=b(c.queryError),h=c.selectArgs?JSON.stringify(c.selectArgs):null;SQLiteJavascriptInterface.executeSql(c.queryId,d.transactionId,e.name,c.sql,h,f,g)},f.openNativeDatabase=function(a,b,c,d,e){var g=f.nativeDBs[a];return g?setTimeout(function(){e&&"function"==typeof e&&e()},0):(g=new i(a),g.init(e),f.nativeDBs[a]=g),g},PouchDroid.SQLiteNativeDB=f}(),function(){"use strict";PouchDroid.Util={debug:function(a,b){if(PouchDroid.DEBUG_MODE&&b){var c=!PouchDroid.DEBUG_CLASSES||-1!==PouchDroid.DEBUG_CLASSES.indexOf(a);if(!c)return;window.console.log(a+": "+b)}}}}(),function(){"use strict";function a(a){PouchDroid.Util.debug("NativeXMLHttpRequest",a)}function b(){var a=this;a.id=c++,a.withCredentials=!1,a.responseType=null,a.onreadystatechange=null,a.readyState=d.UNSENT,a.status=0,a.timeout=0,a.response=null,a.responseText=null,a.requestHeaders={},a.upload={}}var c=0,d={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4};b.prototype.onNativeProgress=function(a){var b=this;a?b.onprogress&&"function"==typeof b.onprogress&&b.onprogress.call(null):b.upload.onprogress&&"function"==typeof b.upload.onprogress&&b.upload.onprogress.call(null)},b.prototype.callOnReadyStateChange=function(){var b=this;a("calling onreadystatechange...");try{b.onreadystatechange()}catch(c){window.console.log("onreadystatechange threw error: "+JSON.stringify(c))}a("called onreadystatechange.")},b.prototype.onNativeCallback=function(b,c,e){var f=this;a("onNativeCallback("+c+", "+e+")"),b&&window.console.log("XHR error: "+JSON.stringify(b)),f.readyState=d.DONE,f.status=c,f.responseText=e,f.callOnReadyStateChange(),delete PouchDroid.NativeXMLHttpRequests[f.id]},b.prototype.open=function(b,c){var e=this;a("open()"),e.state=d.OPENED,e.method=b,e.url=c},b.prototype.abort=function(){var b=this;a("abort()");var c=JSON.stringify(b);try{XhrJavascriptInterface.abort(c)}catch(d){window.console.log("failed to call XhrJavascriptInterface.abort() with selfStringified "+c)}},b.prototype.setRequestHeader=function(b,c){var d=this;a("setRequestHeader()"),d.requestHeaders[b]=c},b.prototype.getRequestHeader=function(b){var c=this;return a("getRequestHeader()"),c.requestHeaders[b]},b.prototype.send=function(b){var c=this;b=b||"","string"!=typeof b&&(window.console.log("body isn't a string!  we don't know what to do!: "+JSON.stringify(b)),b=JSON.stringify(b)),PouchDroid.NativeXMLHttpRequests[c.id]=c;var e=JSON.stringify(c);a("send("+e+","+b+")"),c.state=d.LOADING;try{XhrJavascriptInterface.send(e,b)}catch(f){window.console.log("failed to call XhrJavascriptInterface with selfStringified"+e+" and body "+b)}},PouchDroid.NativeXMLHttpRequest=b,PouchDroid.NativeXMLHttpRequests={}}(),function(){"use strict";Object.keys||(Object.keys=function(a){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.keys called on a non-object");var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)c in this&&a.call(b,this[c],c,this)}),"map"in Array.prototype||(Array.prototype.map=function(a,b){for(var c=new Array(this.length),d=0,e=this.length;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c})}();